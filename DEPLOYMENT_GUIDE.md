# üöÄ Guia de Deployment - MIX App Digital

## üìã Credenciais de Teste

### Usu√°rio de Teste Principal
- **Email:** teste@mixapp.com
- **Senha:** 123456
- **Funciona em:** Qualquer dom√≠nio (incluindo mixapp.digital)

Este usu√°rio possui:
- ‚úÖ Perfil completo com fotos
- ‚úÖ 2 matches ativos (Maria Silva e Ana Costa)
- ‚úÖ Conversas com mensagens
- ‚úÖ Todos os campos preenchidos
- ‚úÖ Pronto para testar todas as funcionalidades

## üíæ Backup e Restaura√ß√£o do Banco de Dados

### Criar Backup

Para criar um backup completo do banco de dados:

```bash
npm run db:backup
```

Isso ir√° gerar um arquivo JSON em `backups/mixapp-backup-[timestamp].json` com todos os dados:
- Usu√°rios e perfis
- Matches e mensagens
- Planos de assinatura
- Configura√ß√µes do app
- Todas as tabelas do sistema

### Restaurar Backup

Para restaurar um backup:

```bash
npm run db:restore backups/mixapp-backup-[timestamp].json
```

## üöÇ Deploy no Railway

Railway √© uma plataforma moderna de deployment com excelente suporte para Node.js e PostgreSQL.

### 1. Criar Conta e Projeto

1. Acesse [Railway.app](https://railway.app)
2. Fa√ßa login com GitHub
3. Clique em "New Project"

### 2. Configurar Banco de Dados PostgreSQL

1. No seu projeto Railway, clique em "New"
2. Selecione "Database" ‚Üí "PostgreSQL"
3. O Railway criar√° automaticamente um banco PostgreSQL
4. Copie a `DATABASE_URL` das vari√°veis de ambiente

### 3. Deploy da Aplica√ß√£o

#### Op√ß√£o A: Via GitHub (Recomendado)

1. No Railway, clique em "New" ‚Üí "GitHub Repo"
2. Conecte seu reposit√≥rio
3. Railway detectar√° automaticamente o `railway.toml`
4. O deploy iniciar√° automaticamente

#### Op√ß√£o B: Via Railway CLI

```bash
# Instalar Railway CLI
npm install -g @railway/cli

# Login
railway login

# Inicializar projeto
railway init

# Deploy
railway up
```

### 4. Configurar Vari√°veis de Ambiente

No painel do Railway, adicione estas vari√°veis:

```env
DATABASE_URL=postgresql://... (copiado do PostgreSQL service)
SESSION_SECRET=seu-secret-super-seguro-aqui
GOOGLE_CLIENT_ID=seu-google-client-id
GOOGLE_CLIENT_SECRET=seu-google-client-secret
STRIPE_SECRET_KEY=seu-stripe-secret-key
STRIPE_PUBLISHABLE_KEY=seu-stripe-publishable-key
```

> ‚ö†Ô∏è **Importante:** N√£o adicione `NODE_ENV=production` nas vari√°veis de ambiente. O Railway configurar√° isso automaticamente durante o runtime. Se voc√™ definir durante o build, as devDependencies (vite, esbuild) n√£o ser√£o instaladas e o build falhar√°.

### 5. Configurar Dom√≠nio

1. No Railway, v√° em Settings
2. Em "Domains", clique em "Generate Domain" (Railway fornece dom√≠nio gratuito)
3. Ou adicione seu dom√≠nio customizado `mixapp.digital`

### 6. Restaurar Backup

Ap√≥s o primeiro deploy:

```bash
# Conectar ao projeto
railway link

# Restaurar dados
npm run db:restore backups/mixapp-backup-[timestamp].json
```

### 7. Health Check

O Railway verificar√° automaticamente a sa√∫de da aplica√ß√£o em `/api/health`

---

## üé® Deploy no Render

Render √© uma alternativa excelente com plano gratuito generoso.

### 1. Criar Conta

1. Acesse [Render.com](https://render.com)
2. Fa√ßa login com GitHub
3. V√° para Dashboard

### 2. Configurar Banco de Dados PostgreSQL

1. Clique em "New +" ‚Üí "PostgreSQL"
2. Configure:
   - **Name:** mixapp-db
   - **Database:** mixapp
   - **User:** mixapp
   - **Region:** Oregon (ou mais pr√≥ximo)
   - **Plan:** Free
3. Clique em "Create Database"
4. Copie a "Internal Database URL"

### 3. Deploy da Aplica√ß√£o

#### Op√ß√£o A: Via Dashboard (Recomendado)

1. No Render Dashboard, clique em "New +" ‚Üí "Web Service"
2. Conecte seu reposit√≥rio GitHub
3. Configure:
   - **Name:** mixapp-digital
   - **Environment:** Node
   - **Region:** Oregon
   - **Branch:** main
   - **Build Command:** `npm run build:production`
   - **Start Command:** `npm run start:production`
4. Clique em "Create Web Service"

#### Op√ß√£o B: Via render.yaml (Blueprint)

O projeto j√° possui `render.yaml` configurado. Basta:

1. No Render, clique em "New +" ‚Üí "Blueprint"
2. Conecte seu reposit√≥rio
3. Render ler√° o `render.yaml` automaticamente
4. Confirme e fa√ßa deploy

### 4. Configurar Vari√°veis de Ambiente

No painel do Render, em "Environment":

```env
DATABASE_URL=postgresql://... (Internal Database URL do PostgreSQL)
SESSION_SECRET=seu-secret-super-seguro-aqui
GOOGLE_CLIENT_ID=seu-google-client-id
GOOGLE_CLIENT_SECRET=seu-google-client-secret
STRIPE_SECRET_KEY=seu-stripe-secret-key
STRIPE_PUBLISHABLE_KEY=seu-stripe-publishable-key
```

> ‚ö†Ô∏è **Importante:** N√£o adicione `NODE_ENV=production` nas vari√°veis de ambiente. O Render configurar√° isso automaticamente durante o runtime. Se voc√™ definir durante o build, as devDependencies (vite, esbuild) n√£o ser√£o instaladas e o build falhar√°.

### 5. Configurar Dom√≠nio

1. Em "Settings", v√° para "Custom Domain"
2. Adicione `mixapp.digital`
3. Configure os DNS records conforme instru√ß√µes

### 6. Health Checks

O Render verificar√° automaticamente `/api/health` conforme configurado no `render.yaml`

### 7. Restaurar Backup

Ap√≥s deploy:

```bash
# Restaurar dados
npm run db:restore backups/mixapp-backup-[timestamp].json
```

---

## üîß Scripts Dispon√≠veis

```bash
# Desenvolvimento
npm run dev                 # Iniciar servidor de desenvolvimento

# Build e Produ√ß√£o
npm run build               # Build normal
npm run build:production    # Build otimizado para produ√ß√£o
npm run start               # Iniciar servidor de produ√ß√£o
npm run start:production    # Iniciar com otimiza√ß√µes de produ√ß√£o

# Banco de Dados
npm run db:push             # Sincronizar schema com banco
npm run db:push --force     # For√ßar sincroniza√ß√£o
npm run db:backup           # Criar backup completo
npm run db:restore          # Restaurar backup
npm run db:generate         # Gerar migrations
npm run db:migrate          # Aplicar migrations

# Utilities
npm run check               # TypeScript type checking
npm run preview             # Build e preview local
```

---

## üìä Compara√ß√£o Railway vs Render

| Feature | Railway | Render |
|---------|---------|--------|
| **Plano Gratuito** | $5 cr√©dito/m√™s | 750h/m√™s |
| **Deploy** | Instant√¢neo | ~2-5 min |
| **PostgreSQL** | Inclu√≠do | Inclu√≠do |
| **Dom√≠nio Gratuito** | ‚úÖ | ‚úÖ |
| **Auto-Deploy** | ‚úÖ | ‚úÖ |
| **WebSockets** | ‚úÖ | ‚úÖ |
| **CLI** | Excelente | Bom |
| **Logs** | Tempo real | Tempo real |
| **Escalabilidade** | Autom√°tica | Autom√°tica |

### Recomenda√ß√£o

- **Railway:** Melhor para desenvolvimento r√°pido, excelente DX
- **Render:** Melhor para produ√ß√£o de longa dura√ß√£o, mais est√°vel

---

## ‚öôÔ∏è Configura√ß√µes Importantes

### PostgreSQL (Neon/Railway/Render)

O projeto funciona com qualquer PostgreSQL moderno:
- ‚úÖ Railway PostgreSQL (recomendado para Railway)
- ‚úÖ Render PostgreSQL (recomendado para Render)
- ‚úÖ Neon (serverless, funciona com ambos)
- ‚úÖ Supabase (alternativa)

### Session e Autentica√ß√£o

- Sessions armazenadas em PostgreSQL via `connect-pg-simple`
- Google OAuth configurado
- Login com email/senha funcionando
- Senhas com bcrypt (hash seguro)
- WebSocket para mensagens em tempo real

### Features do Usu√°rio Teste

O usu√°rio `teste@mixapp.com` pode testar:

1. **Login/Autentica√ß√£o** ‚úÖ
   - Login com email/senha
   - Google OAuth (se configurado)

2. **Perfil** ‚úÖ
   - Ver perfil completo
   - Editar informa√ß√µes
   - Upload de fotos

3. **Descoberta** ‚úÖ
   - Ver perfis dispon√≠veis
   - Dar like/dislike
   - Super likes

4. **Matches** ‚úÖ
   - 2 matches criados
   - Ver lista de matches

5. **Chat** ‚úÖ
   - Conversas com Maria e Ana
   - Enviar mensagens em tempo real
   - WebSocket ativo

6. **Assinaturas** ‚úÖ
   - Ver planos dispon√≠veis
   - Upgrade de conta via Stripe

---

## üîê Seguran√ßa

### Vari√°veis de Ambiente Obrigat√≥rias

```env
# Banco de Dados
DATABASE_URL=postgresql://user:password@host:port/database

# Session
SESSION_SECRET=gere-um-secret-aleatorio-forte-aqui

# OAuth Google (Opcional)
GOOGLE_CLIENT_ID=seu-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=seu-client-secret

# Stripe (Opcional)
STRIPE_SECRET_KEY=sk_live_...
STRIPE_PUBLISHABLE_KEY=pk_live_...
```

> ‚ö†Ô∏è **Nota Importante sobre NODE_ENV:**  
> **N√ÉO configure `NODE_ENV=production` manualmente** nas vari√°veis de ambiente do Railway/Render. As plataformas configuram isso automaticamente durante o runtime. Se voc√™ definir durante o build, as devDependencies (vite, esbuild, cross-env) n√£o ser√£o instaladas e o build falhar√°.

### Gerar SESSION_SECRET Seguro

```bash
# Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"

# OpenSSL
openssl rand -hex 32

# Python
python -c "import secrets; print(secrets.token_hex(32))"
```

### Recomenda√ß√µes de Seguran√ßa

- ‚úÖ Use senhas fortes em produ√ß√£o
- ‚úÖ Configure rate limiting (j√° implementado)
- ‚úÖ HTTPS autom√°tico (Railway/Render)
- ‚úÖ CORS configurado adequadamente
- ‚úÖ Vari√°veis de ambiente para todos os secrets
- ‚úÖ Nunca commite `.env` ou secrets
- ‚úÖ Altere senha do usu√°rio teste em produ√ß√£o

---

## üÜò Troubleshooting

### Erro de Conex√£o com Banco

```bash
# Verificar DATABASE_URL
echo $DATABASE_URL

# Testar conex√£o localmente
npm run db:push

# Verificar se o banco est√° acess√≠vel
psql $DATABASE_URL
```

### Erro no Build

```bash
# Limpar cache e reinstalar
rm -rf node_modules dist
npm install
npm run build:production

# Verificar TypeScript
npm run check
```

### Erro de Session

Se sess√µes n√£o persistem:
1. Verifique se `DATABASE_URL` est√° configurado
2. Verifique se a tabela `session` foi criada
3. Execute `npm run db:push` para criar tabelas

### WebSocket n√£o conecta

1. Verifique se o servidor suporta WebSocket (Railway ‚úÖ, Render ‚úÖ)
2. Em produ√ß√£o, WebSocket usa wss:// automaticamente
3. Verifique logs do servidor

### Usu√°rio Teste N√£o Funciona

```bash
# Restaurar backup
npm run db:restore backups/seu-backup.json

# Verificar se usu√°rio existe
# Use interface do Railway/Render para acessar banco
```

---

## üìà Monitoramento

### Railway

- Dashboard ‚Üí Metrics
- CPU, Memory, Network em tempo real
- Logs com busca e filtros
- Alerts configur√°veis

### Render

- Dashboard ‚Üí Metrics
- Response time, throughput
- Logs em tempo real
- Email alerts para erros

### Recomenda√ß√µes

Monitor essencial:
- ‚úÖ Logs de erro
- ‚úÖ Performance do banco
- ‚úÖ Uso de mem√≥ria
- ‚úÖ Tempo de resposta
- ‚úÖ Taxa de erros

---

## üöÄ Deploy Checklist

Antes de fazer deploy em produ√ß√£o:

- [ ] Criar backup do banco de dados atual
- [ ] Configurar todas as vari√°veis de ambiente
- [ ] Gerar `SESSION_SECRET` forte e √∫nico
- [ ] Configurar Google OAuth (se necess√°rio)
- [ ] Configurar Stripe (se necess√°rio)
- [ ] Testar build localmente: `npm run build:production`
- [ ] Verificar que `DATABASE_URL` est√° correto
- [ ] Configurar dom√≠nio customizado
- [ ] Fazer deploy
- [ ] Verificar health check: `https://seu-dominio/api/health`
- [ ] Restaurar backup se necess√°rio
- [ ] Testar login com usu√°rio teste
- [ ] Testar todas as funcionalidades principais
- [ ] Configurar monitoramento e alerts
- [ ] Alterar/remover usu√°rio teste

---

## üìû Recursos e Documenta√ß√£o

- [Railway Documentation](https://docs.railway.app)
- [Render Documentation](https://render.com/docs)
- [Drizzle ORM Docs](https://orm.drizzle.team)
- [Express.js Guide](https://expressjs.com)
- [PostgreSQL Docs](https://www.postgresql.org/docs/)

---

## üéâ Conclus√£o

Seu MIX App Digital est√° pronto para produ√ß√£o!

**Railway** e **Render** s√£o plataformas modernas que simplificam deployment:
- ‚úÖ Deploy autom√°tico via GitHub
- ‚úÖ PostgreSQL gerenciado inclu√≠do
- ‚úÖ SSL/HTTPS autom√°tico
- ‚úÖ Escalabilidade autom√°tica
- ‚úÖ Logs e m√©tricas em tempo real
- ‚úÖ Planos gratuitos generosos

Escolha a plataforma que melhor atende suas necessidades e fa√ßa deploy com confian√ßa! üöÄ

---

‚úÖ **Tudo pronto para deploy no Railway ou Render!**
